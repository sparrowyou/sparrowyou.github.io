<!DOCTYPE HTML>
<html lang="zh-cn">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="OpenGL, Sparrow">
    <meta name="description" content="OpenGL环境配置
C++编译工具链：MinGW
编辑器：VSCode
项目构建：VSCode配置文件\Cmake
依赖库：GLFW, GLEW

vscode构建项目目录结构：

src: 源代码存放路径
build: 生成文件存放路径">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>OpenGL | Sparrow</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Sparrow</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Sparrow</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">OpenGL</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/C/">
                                <span class="chip bg-color">C++</span>
                            </a>
                        
                            <a href="/tags/OpenGL/">
                                <span class="chip bg-color">OpenGL</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" class="post-category">
                                游戏引擎
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2023-10-15
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li>C++编译工具链：MinGW</li>
<li>编辑器：VSCode</li>
<li>项目构建：VSCode配置文件\Cmake</li>
<li>依赖库：GLFW, GLEW</li>
</ul>
<h3 id="vscode构建项目"><a href="#vscode构建项目" class="headerlink" title="vscode构建项目"></a>vscode构建项目</h3><p><strong>目录结构</strong>：</p>
<ul>
<li>src: 源代码存放路径</li>
<li>build: 生成文件存放路径</li>
<li>include: 头文件存放路径</li>
<li>libraries: 依拉库存放路径</li>
</ul>
<h4 id="launch-json文件配置"><a href="#launch-json文件配置" class="headerlink" title="launch.json文件配置"></a>launch.json文件配置</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"C/C++: g++.exe build and debug active file"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"${fileDirname}\\..\\build\\${fileBasenameNoExtension}.exe"</span><span class="token punctuation">,</span>     <span class="token comment">// debug时检测exe文件位置</span>
            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${fileDirname}"</span><span class="token punctuation">,</span>        <span class="token comment">// 调试程序时的工作目录，一般为${workspaceRoot}即代码所在目录</span>
            <span class="token property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>       <span class="token comment">// 调试时是否显示控制台窗口</span>
            <span class="token property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>
            <span class="token property">"miDebuggerPath"</span><span class="token operator">:</span> <span class="token string">"C:\\msys64\\ucrt64\\bin\\gdb.exe"</span><span class="token punctuation">,</span>       <span class="token comment">// debug编译器路径</span>
            <span class="token property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Enable pretty-printing for gdb"</span><span class="token punctuation">,</span>
                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>
                    <span class="token property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Set Disassembly Flavor to Intel"</span><span class="token punctuation">,</span>
                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-gdb-set disassembly-flavor intel"</span><span class="token punctuation">,</span>
                    <span class="token property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"C/C++: g++.exe build active file"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h4 id="c-cpp-properties-json文件配置"><a href="#c-cpp-properties-json文件配置" class="headerlink" title="c_cpp_properties.json文件配置"></a>c_cpp_properties.json文件配置</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Win32"</span><span class="token punctuation">,</span>
            <span class="token property">"includePath"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"${workspaceFolder}/**"</span><span class="token punctuation">,</span>
                <span class="token string">"${workspaceFolder}\\include"</span>       <span class="token comment">// 包含项目存放头文件位置的文件夹</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"defines"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    
                <span class="token string">"GLEW STATIC"</span><span class="token punctuation">,</span>      <span class="token comment">// 预处理宏定义</span>
                <span class="token string">"_DEBUG"</span><span class="token punctuation">,</span>
                <span class="token string">"UNICODE"</span><span class="token punctuation">,</span>
                <span class="token string">"_UNICODE"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"cStandard"</span><span class="token operator">:</span> <span class="token string">"c17"</span><span class="token punctuation">,</span>
            <span class="token property">"cppStandard"</span><span class="token operator">:</span> <span class="token string">"gnu++17"</span><span class="token punctuation">,</span>       <span class="token comment">// c++版本</span>
            <span class="token property">"intelliSenseMode"</span><span class="token operator">:</span> <span class="token string">"windows-gcc-x64"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h4 id="task-json文件配置"><a href="#task-json文件配置" class="headerlink" title="task.json文件配置"></a>task.json文件配置</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppbuild"</span><span class="token punctuation">,</span>
            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"C/C++: g++.exe build active file"</span><span class="token punctuation">,</span>
            <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"C:\\msys64\\ucrt64\\bin\\g++.exe"</span><span class="token punctuation">,</span>
            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"-fdiagnostics-color=always"</span><span class="token punctuation">,</span>
                <span class="token string">"-g"</span><span class="token punctuation">,</span>
                <span class="token string">"${file}"</span><span class="token punctuation">,</span>      <span class="token comment">// 编译单文件，编译多文件时{fileDirname}\\*.cpp</span>
                <span class="token comment">// "-fexec-charset=GBK",   // 处理mingw中文编码问题</span>
                <span class="token comment">// "-finput-charset=UTF-8",// 处理mingw中文编码问题，没有这俩中文显示会乱码</span>
                <span class="token string">"-o"</span><span class="token punctuation">,</span>
                <span class="token string">"${fileDirname}\\..\\build\\${fileBasenameNoExtension}.exe"</span><span class="token punctuation">,</span>        <span class="token comment">// 编译后.exe文件生成的位置</span>
                <span class="token string">"-I"</span><span class="token punctuation">,</span>
                <span class="token string">"${fileDirname}\\..\\include"</span><span class="token punctuation">,</span>          <span class="token comment">// 头文件存放位置</span>
                <span class="token string">"-L"</span><span class="token punctuation">,</span>
                <span class="token string">"${fileDirname}\\..\\Libraries\\lib-glfw"</span><span class="token punctuation">,</span>      <span class="token comment">// 依赖库文件存放位置</span>
                <span class="token string">"-l"</span><span class="token punctuation">,</span>
                <span class="token string">"glfw3"</span><span class="token punctuation">,</span>        <span class="token comment">// 库文件名称（静态库名称去除前面的lib，且不加文件类型.a）</span>
                <span class="token string">"-lgdi32"</span><span class="token punctuation">,</span>      <span class="token comment">// mingw编译glfw必须包含的库</span>
                <span class="token string">"-lopengl32"</span>        <span class="token comment">// 编译glfw必须包含的库</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${fileDirname}"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"problemMatcher"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"$gcc"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"group"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>
                <span class="token property">"isDefault"</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"detail"</span><span class="token operator">:</span> <span class="token string">"Task generated by Debugger."</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="Cmake构建项目"><a href="#Cmake构建项目" class="headerlink" title="Cmake构建项目"></a>Cmake构建项目</h3><h2 id="OpenGL基础使用"><a href="#OpenGL基础使用" class="headerlink" title="OpenGL基础使用"></a>OpenGL基础使用</h2><h3 id="GLFW-GLEW初始化"><a href="#GLFW-GLEW初始化" class="headerlink" title="GLFW&amp;GLEW初始化"></a>GLFW&amp;GLEW初始化</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"GL/glew.h"</span>        <span class="token comment">// glew头文件导入必须在glfw前面</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"GLFW/glfw3.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">;</span>

    <span class="token comment">/* Initialize the library */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/* Create a windowed mode window and its OpenGL context */</span>
    window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Make the window's context current */</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">glewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> GLEW_OK <span class="token punctuation">)</span>     <span class="token comment">// glew初始化位置</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Error!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">glGetString</span><span class="token punctuation">(</span>GL_VERSION<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">/* Loop until the user closes the window */</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/* Render here */</span>
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Traditional OpenGL draws triangles */</span>
        <span class="token function">glBegin</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glVertex2f</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glVertex2f</span><span class="token punctuation">(</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glVertex2f</span><span class="token punctuation">(</span> <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Draw triangles when there is no index buffer */</span>
        <span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Swap front and back buffers */</span>
        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Poll for and process events */</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="顶点缓冲区（Vertex-Buffer）"><a href="#顶点缓冲区（Vertex-Buffer）" class="headerlink" title="顶点缓冲区（Vertex Buffer）"></a>顶点缓冲区（Vertex Buffer）</h3><p>顶点缓冲区是一个用于存储顶点数据的OpenGL缓冲区对象。它通常用于存储顶点的坐标、颜色、法线和其他属性。使用顶点缓冲区可以有效地管理和渲染大量顶点数据，提高图形渲染的性能。</p>
<p>以下是使用OpenGL顶点缓冲区的一般步骤：</p>
<ol>
<li><p>创建顶点缓冲区对象（Vertex Buffer Object，VBO）：VBO用于存储实际的顶点数据。</p>
 <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">GLuint VBO<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>将顶点数据上传到VBO：</p>
<p> <code>glBufferData</code>是OpenGL用于将数据传递到指定缓冲区的函数。这个函数允许将数据从一个数组或内存块复制到一个缓冲区对象中。<br> 以下是<code>glBufferData</code>的基本用法：</p>
 <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glBufferData</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> size<span class="token punctuation">,</span> data<span class="token punctuation">,</span> usage<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 参数说明：</p>
<ul>
<li><p><code>target</code>：指定缓冲区的类型，通常为以下之一：</p>
</li>
<li><p><code>GL_ARRAY_BUFFER</code>：用于顶点数据。</p>
</li>
<li><p><code>GL_ELEMENT_ARRAY_BUFFER</code>：用于索引数据。</p>
</li>
<li><p>其他类型，如<code>GL_UNIFORM_BUFFER</code>等，用于不同的数据类型。</p>
</li>
<li><p><code>size</code>：指定要复制的数据的字节数。如果数据是一个数组，可以使用<code>sizeof</code>运算符来计算大小。</p>
</li>
<li><p><code>data</code>：指向包含要复制的数据的指针。可以是一个数组或其他内存块。</p>
</li>
<li><p><code>usage</code>：指定缓冲区的使用模式，通常为以下之一：</p>
</li>
<li><p><code>GL_STATIC_DRAW</code>：数据很少改变，用于传递一次的情况。</p>
</li>
<li><p><code>GL_DYNAMIC_DRAW</code>：数据会在渲染循环中更改。</p>
</li>
<li><p><code>GL_STREAM_DRAW</code>：数据频繁更改，用于每帧更新的情况。</p>
</li>
</ul>
<p> 示例代码如下，将数据传递到<code>GL_ARRAY_BUFFER</code>：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c">GLfloat vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>
    <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

GLuint VBO<span class="token punctuation">;</span> <span class="token comment">// 创建一个顶点缓冲区对象</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>VBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> VBO<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 绑定缓冲区对象</span>

<span class="token comment">// 使用glBufferData将顶点数据传递到VBO</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 现在VBO包含了顶点数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置顶点属性指针：告诉OpenGL如何解释顶点数据。</p>
<p> 配置顶点属性指针是告诉OpenGL如何解释顶点数据的重要一步。它定义了顶点数据在顶点缓冲区中的布局和每个顶点包含的属性，例如坐标、颜色、法线等。</p>
<p> <strong>使用函数：</strong></p>
<ol>
<li><p>使用<code>glVertexAttribPointer</code>函数配置顶点属性指针。该函数的参数如下：</p>
<ul>
<li><code>index</code>：指定顶点属性的索引，通常从0开始递增。</li>
<li><code>size</code>：指定属性的大小，例如，如果是三维坐标，它应该是3。</li>
<li><code>type</code>：指定属性数据的类型，例如<code>GL_FLOAT</code>表示浮点数。</li>
<li><code>normalized</code>：指定是否对数据进行归一化。通常为<code>GL_FALSE</code>。</li>
<li><code>stride</code>：指定相邻顶点数据之间的偏移量（字节数）。</li>
<li><code>pointer</code>：指定顶点数据在缓冲区中的偏移位置。</li>
</ul>
</li>
<li><p>使用<code>glEnableVertexAttribArray</code>函数启用顶点属性数组。这一步是可选的，但通常都会启用它。</p>
</li>
</ol>
<p> <strong>示例</strong>：</p>
 <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 假设vertices数组包含顶点数据，其中包括坐标和纹理</span>
GLfloat vertices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token comment">// 顶点1坐标 (x, y, z) 和纹理</span>
    <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>  <span class="token comment">// 顶点2坐标 (x, y, z) 和纹理</span>
    <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span>   <span class="token comment">// 顶点3坐标 (x, y, z) 和纹理</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 配置顶点属性指针</span>
<span class="token comment">// 顶点坐标属性</span>
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 纹理属性</span>
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>GLfloat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 在这个示例中，我们将顶点坐标和纹理数据分别配置为两个不同的顶点属性（索引0和1）。每个顶点属性包括大小、数据类型、偏移量和指针。然后，我们启用了这两个属性数组。</p>
<blockquote>
<p>注意：要正确渲染这些数据，还需要在渲染循环中设置相应的着色器程序，以处理顶点属性数据。这通常涉及到在顶点着色器中定义相应的输入变量，并在片段着色器中使用它们来进行渲染。</p>
</blockquote>
</li>
<li><p>解绑VBO和VAO（在渲染后可选，但建议）：</p>
 <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>在渲染循环中绑定VAO并绘制：</p>
 <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glDrawArrays</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 例如，绘制一个三角形</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="着色器（shader）"><a href="#着色器（shader）" class="headerlink" title="着色器（shader）"></a>着色器（shader）</h3><p>着色器（Shader）是一种用于在图形渲染管线中执行特定任务的计算程序。它们通常用于图形编程中，特别是在OpenGL和DirectX等图形API中。</p>
<p>着色器在渲染管线的不同阶段执行各种任务，以确定最终像素的颜色和位置。</p>
<p>常见的着色器类型包括顶点着色器、片段着色器、几何着色器、像素着色器等。</p>
<p>以下是一些常见类型的着色器以及它们的主要功能：</p>
<ol>
<li><p><strong>顶点着色器（Vertex Shader）</strong>：</p>
<ul>
<li>主要任务是将对象的顶点坐标从模型空间变换到屏幕空间。这包括模型视图变换、投影变换等。</li>
<li>可以执行法线变换和颜色插值等操作。</li>
</ul>
</li>
<li><p><strong>片段着色器（Fragment Shader）</strong>：</p>
<ul>
<li>在每个像素上运行，用于确定像素的最终颜色。</li>
<li>可以执行光照计算、纹理采样、透明度处理等。</li>
</ul>
</li>
<li><p><strong>几何着色器（Geometry Shader）</strong>：</p>
<ul>
<li>可选组件，用于处理图元（点、线、三角形）级别的操作，如创建新的图元、剔除不可见的图元等。</li>
<li>通常用于执行粒子系统、几何变形等任务。</li>
</ul>
</li>
<li><p><strong>计算着色器（Compute Shader）</strong>：</p>
<ul>
<li>不与渲染管线直接相关，用于通用计算任务，如物理模拟、数据处理、图像处理等。</li>
<li>可以在GPU上并行执行计算任务。</li>
</ul>
</li>
</ol>
<p>顶点着色器和片段着色器是图形渲染中的核心组件，它们协同工作以实现渲染的绝大多数方面。</p>
<p>着色器通常使用GLSL（OpenGL Shading Language）或HLSL（High-Level Shading Language）等编程语言编写。</p>
<p>典型的渲染流程包括将几何数据传递到顶点着色器，然后经过变换和插值，传递到片段着色器，最终计算每个像素的颜色值。这个过程可以通过编写适当的着色器程序来实现，以实现各种渲染效果，包括光照、阴影、材质、纹理映射等。</p>
<p>创建着色器</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">ShaderProgramSource</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string VertexSource<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string FragmentSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* read the shader program */</span>
<span class="token keyword">static</span> ShaderProgramSource <span class="token function">ParseShader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filepath<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">stream</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">ShaderType</span>
    <span class="token punctuation">{</span>
        NONE <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> VERTEX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> FRAGMENT <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>stringstream ss<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    ShaderType type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>NONE<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"#shader"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"vertex"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
                type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>VERTEX<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"fragment"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
                type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>FRAGMENT<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            ss<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>type<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ss<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader_type<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> source<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader_id <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>shader_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glShaderSource</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>src<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glCompileShader</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* error handling */</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> GL_COMPILE_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> GL_FALSE<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> length<span class="token punctuation">;</span>
        <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> GL_INFO_LOG_LENGTH<span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">alloca</span><span class="token punctuation">(</span>length <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGetShaderInfoLog</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> length<span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to compile"</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>shader_type <span class="token operator">==</span> GL_VERTEX_SHADER <span class="token operator">?</span> <span class="token string">"vertex"</span> <span class="token operator">:</span> <span class="token string">"fragment"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   

    <span class="token keyword">return</span> shader_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* create shader */</span>
<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">CreateShader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> vertexShader<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> fragmentShader<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shaderProgram <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> vs <span class="token operator">=</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> fs <span class="token operator">=</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> vs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLinkProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> shaderProgram<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* use shader */</span>
  ShaderProgramSource source <span class="token operator">=</span> <span class="token function">ParseShader</span><span class="token punctuation">(</span><span class="token string">"../res/shaders/basic.shader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader <span class="token operator">=</span> <span class="token function">CreateShader</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>VertexSource<span class="token punctuation">,</span> source<span class="token punctuation">.</span>FragmentSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">glUseProgram</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>定义了一个结构体 <code>ShaderProgramSource</code>，并实现了一个函数 <code>ParseShader</code> 用于从文件中解析着色器程序的源代码。</p>
</blockquote>
<blockquote>
<p>两个主要函数：<code>CompileShader</code> 和 <code>CreateShader</code>用于编译和创建OpenGL着色器程序，以及相应的错误处理部分。</p>
</blockquote>
<p><strong><code>CompileShader</code> 函数</strong>：</p>
<ol>
<li><p><code>unsigned int shader_id = glCreateShader(shader_type)</code>: 创建一个OpenGL着色器对象，<code>shader_type</code> 参数指定了着色器的类型，可以是 <code>GL_VERTEX_SHADER</code> 或 <code>GL_FRAGMENT_SHADER</code>。</p>
</li>
<li><p><code>const char* src = source.c_str()</code>: 将着色器源代码从C++的字符串格式转换为C风格的字符数组，以便传递给OpenGL。</p>
</li>
<li><p><code>glShaderSource(shader_id, 1, &amp;src, nullptr)</code>: 将着色器源代码关联到着色器对象 <code>shader_id</code> 上。</p>
</li>
<li><p><code>glCompileShader(shader_id)</code>: 编译着色器源代码。</p>
</li>
<li><p><strong>错误处理</strong>：接下来的代码段用于检查着色器编译是否成功。它通过调用 <code>glGetShaderiv</code> 来获取编译状态，并检查 <code>GL_COMPILE_STATUS</code> 是否为 <code>GL_FALSE</code>，表示编译失败。</p>
</li>
<li><p>如果编译失败，它获取编译错误消息的长度，并分配足够的内存来存储错误消息。</p>
</li>
<li><p>然后，它再次调用 <code>glGetShaderInfoLog</code> 来获取实际的错误消息并将其存储在 <code>message</code> 变量中。</p>
</li>
<li><p>最后，它打印出错误消息，指明是顶点着色器还是片段着色器编译失败，并释放不再需要的着色器对象。</p>
</li>
<li><p>如果编译成功，函数返回着色器对象的ID。</p>
</li>
</ol>
<p><strong><code>CreateShader</code> 函数</strong>：</p>
<ol>
<li><p><code>unsigned int shaderProgram = glCreateProgram()</code>: 创建一个OpenGL着色器程序对象，该对象用于将顶点着色器和片段着色器链接在一起。</p>
</li>
<li><p><code>unsigned int vs = CompileShader(GL_VERTEX_SHADER, vertexShader)</code>: 调用 <code>CompileShader</code> 函数编译顶点着色器，并将其结果存储在 <code>vs</code> 变量中。</p>
</li>
<li><p><code>unsigned int fs = CompileShader(GL_FRAGMENT_SHADER, fragmentShader)</code>: 调用 <code>CompileShader</code> 函数编译片段着色器，并将其结果存储在 <code>fs</code> 变量中。</p>
</li>
<li><p><code>glAttachShader(shaderProgram, vs)</code>: 将顶点着色器附加到着色器程序上。</p>
</li>
<li><p><code>glAttachShader(shaderProgram, fs)</code>: 将片段着色器附加到着色器程序上。</p>
</li>
<li><p><code>glLinkProgram(shaderProgram)</code>: 链接着色器程序。</p>
</li>
<li><p><code>glDeleteShader(vs)</code> 和 <code>glDeleteShader(fs)</code>: 删除不再需要的顶点和片段着色器对象。</p>
</li>
<li><p>最后，函数返回着色器程序的ID，可以用于渲染图形。</p>
</li>
</ol>
<p>**结构体 <code>ShaderProgramSource</code>，函数 <code>ParseShader</code> **</p>
<ol>
<li><p><code>struct ShaderProgramSource { ... }</code>: 这是一个C++结构体定义，用于存储着色器程序的顶点着色器和片段着色器的源代码。它包含两个成员变量：<code>VertexSource</code> 和 <code>FragmentSource</code>，分别用于存储顶点着色器和片段着色器的源代码。</p>
</li>
<li><p><code>static ShaderProgramSource ParseShader(const std::string&amp; filepath)</code>: 这是一个静态函数，用于解析着色器程序文件并返回一个 <code>ShaderProgramSource</code> 结构体。它接受一个文件路径作为参数，以便读取文件内容。</p>
</li>
<li><p><code>std::ifstream stream(filepath)</code>: 在函数内部，它打开指定的文件，创建一个输入文件流（ifstream），文件路径由传递给函数的 <code>filepath</code> 参数指定。</p>
</li>
<li><p><code>enum class ShaderType { ... }</code>: 这是一个枚举类型定义，用于表示着色器类型。它包含三个成员：<code>NONE</code>、<code>VERTEX</code> 和 <code>FRAGMENT</code>。初始时，<code>type</code> 被设置为 <code>NONE</code>，表示当前没有处于任何特定类型的着色器代码段。</p>
</li>
<li><p><code>std::string line;</code>: 用于存储从文件中逐行读取的文本。</p>
</li>
<li><p><code>std::stringstream ss[2];</code>: 这是一个字符串流数组，其中有两个元素，用于分别存储顶点着色器和片段着色器的源代码。</p>
</li>
<li><p><code>ShaderType type = ShaderType::NONE;</code>: 初始化 <code>type</code> 变量，表示当前没有处于任何特定类型的着色器代码段。</p>
</li>
<li><p><code>while(getline(stream, line)) { ... }</code>: 这是一个循环，它会逐行读取文件内容。</p>
</li>
<li><p>在循环内部，代码检查每一行是否包含 <code>#shader</code>，以确定当前行是否是着色器的声明。如果是，它会进一步检查 <code>vertex</code> 或 <code>fragment</code> 关键字，以确定是顶点着色器还是片段着色器的声明。</p>
</li>
<li><p>如果是着色器代码的一部分，它将该行添加到适当类型（顶点或片段）的字符串流 <code>ss</code> 中。</p>
</li>
<li><p>循环继续，直到文件的末尾。</p>
</li>
<li><p>最后，函数返回一个 <code>ShaderProgramSource</code> 结构体，其中包含了解析的顶点着色器和片段着色器的源代码。</p>
</li>
</ol>
<h3 id="索引缓冲区"><a href="#索引缓冲区" class="headerlink" title="索引缓冲区"></a>索引缓冲区</h3><p>索引缓冲区（Index Buffer）是一种用于优化图形渲染的技术，特别是在处理大型三维模型时非常有用。索引缓冲区允许以一种更有效的方式定义和渲染顶点数据，减少冗余数据的存储和传输，以提高性能。</p>
<p>索引缓冲区的核心思想是将顶点数据和索引数据分开存储。通常有一个包含所有唯一顶点数据的顶点缓冲区，然后另一个缓冲区包含索引，这些索引指示如何组合顶点以构成几何图元（例如，三角形）。</p>
<p>以下是使用索引缓冲区的一般步骤：</p>
<ol>
<li><p><strong>创建顶点缓冲区</strong>：首先，创建一个顶点缓冲区（Vertex Buffer Object，VBO），并将所有唯一的顶点数据存储在其中。这包括位置、颜色、法线等顶点属性。</p>
</li>
<li><p><strong>创建索引缓冲区</strong>：然后，创建一个索引缓冲区（Index Buffer Object，IBO），其中包含表示图元的索引数据。这些索引通常是指向顶点缓冲区中的数据的引用。</p>
</li>
<li><p><strong>绘制对象</strong>：在渲染循环中，绑定顶点缓冲区和索引缓冲区，然后调用绘制命令以绘制几何图元。OpenGL将使用索引缓冲区中的索引来确定要绘制的顶点。</p>
</li>
</ol>
<p>优点和用途：</p>
<ul>
<li><p><strong>减少冗余数据</strong>：索引缓冲区允许多个图元共享相同的顶点数据，减少了内存和数据传输开销。</p>
</li>
<li><p><strong>提高性能</strong>：减少冗余数据传输和处理，提高渲染性能，特别是在大型三维模型的情况下。</p>
</li>
<li><p><strong>支持复杂的模型</strong>：索引缓冲区非常有用，当要渲染的模型包含大量重复顶点数据，例如一个立方体或球体。</p>
</li>
</ul>
<p>使用索引缓冲区时，需要小心确保顶点数据和索引数据的一致性，以及正确绑定和绘制命令的使用。此外，不同的渲染API可能有不同的方式来创建和使用索引缓冲区，但核心思想是相似的。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> indices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* create Index buffer */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> ibo<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ibo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> ibo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* Draw rect with index buffer*/</span>
<span class="token function">glDrawElements</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><h4 id="glGetError"><a href="#glGetError" class="headerlink" title="glGetError"></a><code>glGetError</code></h4><p><code>glGetError</code> 是一个OpenGL函数，用于检查OpenGL中是否有错误发生。OpenGL使用错误标志来记录和报告各种渲染和配置问题。当进行OpenGL操作时，如果出现错误，可以使用 <code>glGetError</code> 来检测和识别这些错误。</p>
<p><code>glGetError</code> 的基本用法如下：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">GLenum error <span class="token operator">=</span> <span class="token function">glGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">!=</span> GL_NO_ERROR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理OpenGL错误</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>一些可能的OpenGL错误码，以及它们的含义：</p>
<ul>
<li><code>GL_NO_ERROR</code>：没有错误。</li>
<li><code>GL_INVALID_ENUM</code>：无效的枚举参数。</li>
<li><code>GL_INVALID_VALUE</code>：无效的数值参数。</li>
<li><code>GL_INVALID_OPERATION</code>：无效的操作。</li>
<li><code>GL_STACK_OVERFLOW</code>：堆栈溢出。</li>
<li><code>GL_STACK_UNDERFLOW</code>：堆栈下溢。</li>
<li><code>GL_OUT_OF_MEMORY</code>：内存不足。</li>
<li><code>GL_INVALID_FRAMEBUFFER_OPERATION</code>：尝试使用无效帧缓冲对象。</li>
</ul>
<p>可以在OpenGL操作之后使用 <code>glGetError</code> 来检查是否发生了错误，然后采取适当的措施来处理这些错误，例如记录错误信息、中止渲染或采取其他适当的操作。通常，这在OpenGL调试和错误排除过程中非常有用。</p>
<blockquote>
<p>请注意，<code>glGetError</code> 只能检测到发生在最后一次OpenGL调用中的错误，它不会跟踪或记录多次操作中的错误。因此，通常需要在每个潜在的错误点后立即检查错误标志。</p>
</blockquote>
<h3 id="统一变量（uniform）"><a href="#统一变量（uniform）" class="headerlink" title="统一变量（uniform）"></a>统一变量（uniform）</h3><p>在OpenGL中，统一变量（Uniform）是一种特殊类型的变量，用于在着色器程序之间传递数据。统一变量的主要特点是它们在着色器程序中是全局的，而且它们的值在多个渲染过程之间保持不变。这使得统一变量非常适合在CPU和GPU之间传递数据，以便在着色器中使用。</p>
<p>在OpenGL中，uniform是一种特殊类型的着色器变量，它具有以下特点：</p>
<ol>
<li><p><strong>Uniform 变量的值在多个顶点或片段之间是相同的</strong>：Uniform 变量的值在一个绘制调用期间对于所有顶点着色器和片段着色器都是相同的。这使得它成为向着色器传递全局数据的一种方式。</p>
</li>
<li><p><strong>Uniform 变量在CPU端设置，但在GPU端访问</strong>：Uniform 变量的值通常是在CPU端设置的，然后在GPU端的着色器中访问。这使得它成为一种在应用程序和着色器之间传递数据的方法。</p>
</li>
<li><p><strong>Uniform 变量适用于各种着色器类型</strong>：Uniform 变量可以在顶点着色器、片段着色器以及其他着色器类型中使用。这使得它非常灵活，可以用于传递不同类型的数据，如变换矩阵、材质属性、光照参数等。</p>
</li>
</ol>
<p><strong>用法：</strong></p>
<ol>
<li><p><strong>声明和使用统一变量</strong>：统一变量通常在着色器程序中以以下方式声明和使用：</p>
<pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">uniform</span> data_type variable_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中，<code>data_type</code> 是变量的数据类型（如float、vec3、mat4等），<code>variable_name</code> 是变量的名称。统一变量的值可以在CPU代码中设置，并在着色器中使用。</p>
</li>
<li><p><strong>数据传递</strong>：可以使用OpenGL的API函数（如<code>glUniform*</code>系列函数）在CPU端将数据设置到统一变量中。例如：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">GLint location <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> <span class="token string">"variable_name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
glUniform<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 使用适当的 glUniform 函数将数据传递给统一变量</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这将允许在渲染过程中将值传递给着色器。</p>
</li>
</ol>
<p><strong>示例：</strong></p>
<ol>
<li><p>shader文件中定义统一变量uniform:</p>
  <pre class="line-numbers language-glsl" data-language="glsl"><code class="language-glsl"><span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_Color<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>主文件中设置和使用uinform：</p>
  <pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> location <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> <span class="token string">"u_Color"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>location <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glUniform4f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token number">0.2f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<blockquote>
<p><code>uniform</code> 设置须在渲染之前</p>
</blockquote>
<p><strong>统一变量出错原因：</strong></p>
<ol>
<li><p><strong>Uniform变量名拼写错误</strong>：确保Uniform变量的名称与着色器代码中的名称完全匹配，包括大小写。在的着色器代码中，Uniform变量名称应该是 “u_Color”，请确保在代码中也是这样。</p>
</li>
<li><p><strong>Uniform变量没有被使用</strong>：如果在着色器中声明了一个Uniform变量但没有在代码中使用它，编译器可能会将其优化掉。请确保Uniform变量在着色器代码中实际使用，以便它在着色器程序中存在。</p>
</li>
<li><p><strong>着色器链接失败</strong>：如果着色器程序的链接失败，Uniform变量可能不会被成功绑定。确保着色器程序的链接没有问题。可以检查着色器程序的链接状态，以确保链接成功。</p>
</li>
<li><p><strong>Uniform变量在错误的着色器阶段</strong>：Uniform变量的存在和位置是着色器阶段相关的。请确保在正确的着色器阶段（顶点着色器或片段着色器）中声明了Uniform变量，并在正确的阶段中尝试设置它。</p>
</li>
</ol>
<h3 id="顶点数组（Vertex-Array）"><a href="#顶点数组（Vertex-Array）" class="headerlink" title="顶点数组（Vertex Array）"></a>顶点数组（Vertex Array）</h3><p>OpenGL中的顶点数组是一种用于存储和组织顶点数据的数据结构。顶点数组通常与顶点缓冲区对象（Vertex Buffer Object，VBO）一起使用，用于描述三维对象的几何信息，如位置、颜色、法线、纹理坐标等。</p>
<p><strong>顶点数组对象（Vertex Array Object，VAO）：</strong><br>    VAO是用于存储和管理顶点属性指针的OpenGL对象。它可以包括多个VBO和IBO（索引缓冲对象）。VAO的目的是封装顶点属性指针的状态，以便轻松地切换不同的顶点数据布局。</p>
<blockquote>
<p>如果使用核心配置文件，则必须创建顶点数组对象<br>使用兼容性配置文件时，有一个默认的顶点数组对象，可以不单独创建</p>
</blockquote>
<blockquote>
<p>顶点数组对象包含定点换种去之间的绑定，以及实际定点规范或布局</p>
</blockquote>
<p><strong>创建和绑定顶点数组:</strong><br>   </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> vao<span class="token punctuation">;</span>
<span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p></p>
<p>渲染时：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将代替：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="整体代码展示"><a href="#整体代码展示" class="headerlink" title="整体代码展示"></a>整体代码展示</h3><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"GL/glew.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"GLFW/glfw3.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GLCall</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> GLClearError<span class="token punctuation">;</span></span><span class="token punctuation">\</span>
<span class="token expression">x<span class="token punctuation">;</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">GLLogCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span> <span class="token function">GLClearError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">glGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> GL_NO_ERROR<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">GLLogCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>GLenum error <span class="token operator">=</span> <span class="token function">glGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[OpenGL_Error] ("</span> <span class="token operator">&lt;&lt;</span> error <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">ShaderProgramSource</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string VertexSource<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string FragmentSource<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* read the shader program */</span>
<span class="token keyword">static</span> ShaderProgramSource <span class="token function">ParseShader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filepath<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">stream</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">ShaderType</span>
    <span class="token punctuation">{</span>
        NONE <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> VERTEX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> FRAGMENT <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>stringstream ss<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    ShaderType type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>NONE<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"#shader"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"vertex"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
                type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>VERTEX<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"fragment"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
                type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>FRAGMENT<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            ss<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>type<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ss<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader_type<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> source<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader_id <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>shader_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glShaderSource</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>src<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glCompileShader</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* error handling */</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> GL_COMPILE_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> GL_FALSE<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> length<span class="token punctuation">;</span>
        <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> GL_INFO_LOG_LENGTH<span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">alloca</span><span class="token punctuation">(</span>length <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGetShaderInfoLog</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> length<span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to compile"</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>shader_type <span class="token operator">==</span> GL_VERTEX_SHADER <span class="token operator">?</span> <span class="token string">"vertex"</span> <span class="token operator">:</span> <span class="token string">"fragment"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   

    <span class="token keyword">return</span> shader_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* create shader */</span>
<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">CreateShader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> vertexShader<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> fragmentShader<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shaderProgram <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> vs <span class="token operator">=</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> fs <span class="token operator">=</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> vs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLinkProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> shaderProgram<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    GLFWwindow<span class="token operator">*</span> window<span class="token punctuation">;</span>

    <span class="token comment">/* Initialize the library */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/* Create a windowed mode window and its OpenGL context */</span>
    window <span class="token operator">=</span> <span class="token function">glfwCreateWindow</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token string">"Hello World"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Make the window's context current */</span>
    <span class="token function">glfwMakeContextCurrent</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glfwSwapInterval</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">glewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> GLEW_OK <span class="token punctuation">)</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Error!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">glGetString</span><span class="token punctuation">(</span>GL_VERSION<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">float</span> positions<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>   <span class="token comment">// 0</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>   <span class="token comment">// 1</span>
         <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span>   <span class="token comment">// 2</span>
        <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span>   <span class="token comment">// 3</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> indices<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/* Build VAO and bind*/</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> vao<span class="token punctuation">;</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Build the buffer */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> buffer<span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> positions<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Configure vertex properties */</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* create Index buffer */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ibo<span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ibo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> ibo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indices<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* create shader*/</span>
    ShaderProgramSource source <span class="token operator">=</span> <span class="token function">ParseShader</span><span class="token punctuation">(</span><span class="token string">"../res/shaders/basic.shader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Vertex"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> source<span class="token punctuation">.</span>VertexSource <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Fragment"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> source<span class="token punctuation">.</span>FragmentSource <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader <span class="token operator">=</span> <span class="token function">CreateShader</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>VertexSource<span class="token punctuation">,</span> source<span class="token punctuation">.</span>FragmentSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glUseProgram</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* set the value of uniform */</span>
    <span class="token keyword">int</span> location <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> <span class="token string">"u_Color"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>location <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glUniform4f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> <span class="token number">0.2f</span><span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Unbind object */</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glUseProgram</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">float</span> r <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> increment <span class="token operator">=</span> <span class="token number">0.05f</span><span class="token punctuation">;</span>

    <span class="token comment">/* Loop until the user closes the window */</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">glfwWindowShouldClose</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/* Render here */</span>
        <span class="token function">glClear</span><span class="token punctuation">(</span>GL_COLOR_BUFFER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Traditional OpenGL draws triangles */</span>
        <span class="token comment">// glBegin(GL_TRIANGLES);</span>
        <span class="token comment">// glVertex2f(-0.5f, -0.5f);</span>
        <span class="token comment">// glVertex2f( 0.0f,  0.5f);</span>
        <span class="token comment">// glVertex2f( 0.5f, -0.5f);</span>
        <span class="token comment">// glEnd();</span>

        <span class="token comment">/* Draw triangles when there is no index buffer */</span>
        <span class="token comment">// glDrawArrays(GL_TRIANGLES, 0, 6);</span>

        <span class="token comment">/* Draw rect with index buffer*/</span>
        <span class="token function">glUseProgram</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glUniform4f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">0.3f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>vao<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// glBindBuffer(GL_ARRAY_BUFFER, buffer);</span>
        <span class="token comment">// glEnableVertexAttribArray(0);</span>
        <span class="token comment">// glVertexAttribPointer(0, 2, GL_FLOAT, GL_FALSE, sizeof(float) * 2, 0);</span>

        <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> ibo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">glDrawElements</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&gt;</span> <span class="token number">1.0f</span><span class="token punctuation">)</span>
            increment <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.05f</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">&lt;</span> <span class="token number">0.0f</span><span class="token punctuation">)</span>
            increment <span class="token operator">=</span> <span class="token number">0.05f</span><span class="token punctuation">;</span>
        
        r <span class="token operator">+=</span> increment<span class="token punctuation">;</span>

        <span class="token comment">/* Swap front and back buffers */</span>
        <span class="token function">glfwSwapBuffers</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Poll for and process events */</span>
        <span class="token function">glfwPollEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glfwTerminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="将代码抽象成类"><a href="#将代码抽象成类" class="headerlink" title="将代码抽象成类"></a>将代码抽象成类</h2><h3 id="抽象错误处理成类"><a href="#抽象错误处理成类" class="headerlink" title="抽象错误处理成类"></a>抽象错误处理成类</h3><p>头文件：</p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#ifndef __RENDERER_H_
#define __RENDERER_H_

#include &lt;GL\glew.h&gt;
#include &lt;assert.h&gt;
#define GLCall(x) GLClearError;\
x;\
assert(GLLogCall())

void GLClearError();
bool GLLogCall();

#endif<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>cpp文件：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Renderer.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">GLClearError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">glGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> GL_NO_ERROR<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token function">GLLogCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>GLenum error <span class="token operator">=</span> <span class="token function">glGetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[OpenGL_Error] ("</span> <span class="token operator">&lt;&lt;</span> error <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="抽象顶点缓冲区成类"><a href="#抽象顶点缓冲区成类" class="headerlink" title="抽象顶点缓冲区成类"></a>抽象顶点缓冲区成类</h3><p>头文件：</p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#pragma once

class VertexBuffer
{
private:
    unsigned int m_RendererID;

public:
    VertexBuffer(const void* data, unsigned int size);
    ~VertexBuffer();

    void Bind() const;
    void Unbind() const;
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>cpp文件：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"VertexBuffer.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Renderer.h"</span></span>

<span class="token class-name">VertexBuffer</span><span class="token double-colon punctuation">::</span><span class="token function">VertexBuffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> size<span class="token punctuation">,</span> data<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">VertexBuffer</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">VertexBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">VertexBuffer</span><span class="token double-colon punctuation">::</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">VertexBuffer</span><span class="token double-colon punctuation">::</span><span class="token function">Unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="抽象索引缓冲区成类"><a href="#抽象索引缓冲区成类" class="headerlink" title="抽象索引缓冲区成类"></a>抽象索引缓冲区成类</h3><p>头文件：</p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#pragma once

class IndexBuffer
{
private:
    unsigned int m_RendererID;
    unsigned int m_count;

public:
    IndexBuffer(const unsigned int* data, unsigned int count);
    ~IndexBuffer();

    void Bind() const;
    void Unbind() const;

    inline unsigned int GetCount() const { return m_count; };
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>cpp文件</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"IndexBuffer.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Renderer.h"</span></span>

<span class="token class-name">IndexBuffer</span><span class="token double-colon punctuation">::</span><span class="token function">IndexBuffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span> data<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">m_count</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> count <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">IndexBuffer</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">IndexBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glDeleteBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">IndexBuffer</span><span class="token double-colon punctuation">::</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">IndexBuffer</span><span class="token double-colon punctuation">::</span><span class="token function">Unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="抽象顶点数组和布局成类"><a href="#抽象顶点数组和布局成类" class="headerlink" title="抽象顶点数组和布局成类"></a>抽象顶点数组和布局成类</h3><p><strong>布局头文件：</strong></p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#pragma once

#include &lt;vector&gt;
#include "GL/glew.h"
#include &lt;assert.h&gt;

struct VertexBufferElement
{
    unsigned int count;
    unsigned int type;
    unsigned char normalized;

    static unsigned int GetSizeofType(unsigned int type)
    {
        switch (type)
        {
            case GL_FLOAT:                      return 4;
            case GL_UNSIGNED_INT:       return 4;
            case GL_UNSIGNED_BYTE:     return 1;
        }
        // assert(false);   // ？ vscode+mingw此处断言任然生效
        return 0;
    }
};

class VertexBufferLayout
{
private:
    std::vector&lt;VertexBufferElement&gt; m_Elements;
    unsigned int m_Stride;
public:
    VertexBufferLayout()
        : m_Stride(0) {}

    // TODO: 解决在GCC中报错
    /* vs中有效，但vscode+mingw时会报错 */
    /*
    template&lt;typename T&gt;
    void Push(unsigned int count)
    {
        static_assert(false, "Unsupported type in VertexBufferLayout::Push");
    }

    template&lt;&gt;
    void Push&lt;float&gt;(unsigned int count)
    {
        m_Elements.push_back({ count, GL_FLOAT, GL_FALSE });
        m_Stride += count * VertexBufferElement::GetSizeofType(GL_FLOAT);
    }

    template&lt;&gt;
    void Push&lt;unsigned int&gt;(unsigned int count)
    {
        m_Elements.push_back({ count, GL_UNSIGNED_INT, GL_FALSE });
        m_Stride += count * VertexBufferElement::GetSizeofType(GL_UNSIGNED_INT);
    }

    template&lt;&gt;
    void Push&lt;unsigned char&gt;(unsigned int count)
    {
        m_Elements.push_back({ count, GL_UNSIGNED_BYTE, GL_TRUE });
        m_Stride += count * VertexBufferElement::GetSizeofType(GL_UNSIGNED_BYTE);
    }
    */

    void PushFloat(unsigned int count)
    {
        m_Elements.push_back({ count, GL_FLOAT, GL_FALSE });
        m_Stride += count * VertexBufferElement::GetSizeofType(GL_FLOAT);
    }

    void PushUInt(unsigned int count)
    {
        m_Elements.push_back({ count, GL_UNSIGNED_INT, GL_FALSE });
        m_Stride += count * VertexBufferElement::GetSizeofType(GL_UNSIGNED_INT);
    }

    void PushUChar(unsigned int count)
    {
        m_Elements.push_back({ count, GL_UNSIGNED_BYTE, GL_TRUE });
        m_Stride += count * VertexBufferElement::GetSizeofType(GL_UNSIGNED_BYTE);
    }

    inline const std::vector&lt;VertexBufferElement&gt; GetElements() const { return m_Elements; }
    inline unsigned int GetStride() const { return m_Stride; }
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>顶点数组头文件：</strong></p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#pragma once

#include "VertexBuffer.h"
#include "VertexBufferLayout.h"

class VertexArray
{
private:
    unsigned int m_RendererID;
public:
    VertexArray();
    ~VertexArray();

    void AddBuffer(const VertexBuffer&amp; vb, const VertexBufferLayout&amp; layout);

    void Bind() const;
    void Unbind() const;
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>顶点数组cpp文件：</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"VertexArray.h"</span></span>

<span class="token class-name">VertexArray</span><span class="token double-colon punctuation">::</span><span class="token function">VertexArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glGenVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">VertexArray</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">VertexArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glDeleteVertexArrays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">VertexArray</span><span class="token double-colon punctuation">::</span><span class="token function">AddBuffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> VertexBuffer <span class="token operator">&amp;</span>vb<span class="token punctuation">,</span> <span class="token keyword">const</span> VertexBufferLayout <span class="token operator">&amp;</span>layout<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">Bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vb<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> elements <span class="token operator">=</span> layout<span class="token punctuation">.</span><span class="token function">GetElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> element <span class="token operator">=</span> elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> element<span class="token punctuation">.</span>count<span class="token punctuation">,</span> element<span class="token punctuation">.</span>type<span class="token punctuation">,</span> element<span class="token punctuation">.</span>normalized<span class="token punctuation">,</span> layout<span class="token punctuation">.</span><span class="token function">GetStride</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>intptr_t<span class="token punctuation">)</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        offset <span class="token operator">+=</span> element<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token class-name">VertexBufferElement</span><span class="token double-colon punctuation">::</span><span class="token function">GetSizeofType</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">VertexArray</span><span class="token double-colon punctuation">::</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">VertexArray</span><span class="token double-colon punctuation">::</span><span class="token function">Unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="将着色器抽象成类"><a href="#将着色器抽象成类" class="headerlink" title="将着色器抽象成类"></a>将着色器抽象成类</h3><p><strong>头文件：</strong></p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#pragma once

#include &lt;string&gt;
#include &lt;unordered_map&gt;

struct ShaderProgramSource
{
    std::string VertexSource;
    std::string FragmentSource;
};

class Shader
{
private:
    std::string m_Filepath;
    unsigned int m_RendererID;
    // catching for uniforms
    std::unordered_map&lt;std::string, unsigned int&gt; m_UniformLocationCache;
public:
    Shader(const std::string&amp; filepath);
    ~Shader();

    void Bind() const;
    void Unbind() const;

    // Set uniforms
    void SetUniform4f(const std::string&amp; name, float v1, float v2, float v3, float v4);
private:
    ShaderProgramSource ParseShader(const std::string&amp; filepath);
    unsigned int CompileShader(unsigned int shader_type, const std::string&amp; source);
    unsigned int CreateShader(const std::string&amp; vertexShader, const std::string&amp; fragmentShader);
    unsigned int GetUniformLocation(const std::string&amp; name);
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>cpp文件：</strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Shader.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Renderer.h"</span></span>

<span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">Shader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filepath<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">m_Filepath</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_RendererID</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ShaderProgramSource source <span class="token operator">=</span> <span class="token function">ParseShader</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_RendererID <span class="token operator">=</span> <span class="token function">CreateShader</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>VertexSource<span class="token punctuation">,</span> source<span class="token punctuation">.</span>FragmentSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Shader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glDeleteProgram</span><span class="token punctuation">(</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ShaderProgramSource <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">ParseShader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filepath<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">stream</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">ShaderType</span>
    <span class="token punctuation">{</span>
        NONE <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> VERTEX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> FRAGMENT <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>stringstream ss<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    ShaderType type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>NONE<span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"#shader"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"vertex"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
                type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>VERTEX<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"fragment"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
                type <span class="token operator">=</span> ShaderType<span class="token double-colon punctuation">::</span>FRAGMENT<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            ss<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>type<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ss<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">CompileShader</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader_type<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> source<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shader_id <span class="token operator">=</span> <span class="token function">glCreateShader</span><span class="token punctuation">(</span>shader_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glShaderSource</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>src<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glCompileShader</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* error handling */</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> GL_COMPILE_STATUS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> GL_FALSE<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> length<span class="token punctuation">;</span>
        <span class="token function">glGetShaderiv</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> GL_INFO_LOG_LENGTH<span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">alloca</span><span class="token punctuation">(</span>length <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">glGetShaderInfoLog</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">,</span> length<span class="token punctuation">,</span> <span class="token operator">&amp;</span>length<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to compile"</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>shader_type <span class="token operator">==</span> GL_VERTEX_SHADER <span class="token operator">?</span> <span class="token string">"vertex"</span> <span class="token operator">:</span> <span class="token string">"fragment"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>shader_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> shader_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">CreateShader</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> vertexShader<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> fragmentShader<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> shaderProgram <span class="token operator">=</span> <span class="token function">glCreateProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> vs <span class="token operator">=</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span>GL_VERTEX_SHADER<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> fs <span class="token operator">=</span> <span class="token function">CompileShader</span><span class="token punctuation">(</span>GL_FRAGMENT_SHADER<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> vs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glAttachShader</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glLinkProgram</span><span class="token punctuation">(</span>shaderProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>vs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDeleteShader</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> shaderProgram<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glUseProgram</span><span class="token punctuation">(</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">Unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glUseProgram</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">SetUniform4f</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">float</span> v1<span class="token punctuation">,</span> <span class="token keyword">float</span> v2<span class="token punctuation">,</span> <span class="token keyword">float</span> v3<span class="token punctuation">,</span> <span class="token keyword">float</span> v4<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glUniform4f</span><span class="token punctuation">(</span><span class="token function">GetUniformLocation</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token class-name">Shader</span><span class="token double-colon punctuation">::</span><span class="token function">GetUniformLocation</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_UniformLocationCache<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">!=</span> m_UniformLocationCache<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> m_UniformLocationCache<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> location <span class="token operator">=</span> <span class="token function">glGetUniformLocation</span><span class="token punctuation">(</span>m_RendererID<span class="token punctuation">,</span> name<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>location <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Warning: uniform '"</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" ' dosen't exist!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    m_UniformLocationCache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> location<span class="token punctuation">;</span>
    <span class="token keyword">return</span> location<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="纹理"><a href="#纹理" class="headerlink" title="纹理"></a>纹理</h2><p>在OpenGL中添加纹理通常涉及以下步骤：</p>
<ol>
<li><p><strong>加载纹理图像</strong>：首先，需要加载纹理图像文件。通常使用库如stb_image或SOIL（Simple OpenGL Image Library）来加载图像文件。这将为提供图像的像素数据。</p>
</li>
<li><p><strong>创建纹理对象</strong>：在OpenGL中，需要创建一个纹理对象来存储纹理数据。使用 <code>glGenTextures</code> 来生成一个纹理对象的ID。</p>
</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">GLuint textureID<span class="token punctuation">;</span>
<span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>textureID<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="3">
<li><strong>绑定纹理对象</strong>：使用 <code>glBindTexture</code> 来绑定纹理对象，以便后续的操作将影响该纹理对象。</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> textureID<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li><strong>设置纹理参数</strong>：使用 <code>glTexParameteri</code> 来设置纹理参数，如缩小滤波、放大滤波、纹理坐标包裹模式等。这些参数会影响纹理在渲染中的采样行为。</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li><strong>将图像数据上传到纹理对象</strong>：使用 <code>glTexImage2D</code> 来将图像数据上传到纹理对象。需要指定纹理目标（通常是 <code>GL_TEXTURE_2D</code>）、级别、内部像素格式、宽度、高度、边界、源格式和数据类型。</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glTexImage2D</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> level<span class="token punctuation">,</span> internalformat<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> format<span class="token punctuation">,</span> type<span class="token punctuation">,</span> image_data<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>以下是 <code>glTexImage2D</code> 函数的关键参数和用法：</p>
<ul>
<li><p><code>target</code>：指定纹理的类型，通常是 <code>GL_TEXTURE_2D</code> 表示二维纹理。也可以是其他类型，如立方体贴图等。</p>
</li>
<li><p><code>level</code>：指定纹理的细节级别，通常为0表示基本级别。用于创建多级细节纹理（MIP贴图）时，可以设置不同的级别。</p>
</li>
<li><p><code>internalformat</code>：指定纹理数据的内部格式，如 <code>GL_RGBA</code> 表示纹理包含红、绿、蓝和透明度通道。这与实际的纹理图像格式可以不同，OpenGL会根据此内部格式进行适当的转换。</p>
</li>
<li><p><code>width</code> 和 <code>height</code>：指定纹理的宽度和高度，以像素为单位。</p>
</li>
<li><p><code>border</code>：指定边界宽度，通常为0。</p>
</li>
<li><p><code>format</code>：指定纹理数据的格式，如 <code>GL_RGBA</code>。</p>
</li>
<li><p><code>type</code>：指定纹理数据的数据类型，如 <code>GL_UNSIGNED_BYTE</code> 表示数据是无符号字节。</p>
</li>
<li><p><code>data</code>：指定包含图像数据的指针。这是您加载的图像数据的指针。</p>
</li>
</ul>
<p><code>glTexImage2D</code> 的主要作用是将图像数据从CPU内存上传到GPU，以便GPU能够在着色器中对其进行采样和处理。一旦数据被上传到纹理对象，就可以在着色器中使用纹理坐标对纹理进行采样，从而将其应用到渲染的几何体上。</p>
<ol start="6">
<li><strong>解除纹理对象绑定</strong>：最后，使用 <code>glBindTexture</code> 解除对纹理对象的绑定，以确保后续操作不会影响该纹理。</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>以上是添加纹理的基本步骤。在实际应用中，可能需要考虑更多的细节，例如使用多个纹理、纹理过滤、MIP映射、多重渲染目标等。同时，还需要在着色器中使用纹理坐标来采样纹理，以便在渲染中应用纹理。</p>
<p>实际使用时需要先激活纹理插槽并绑定纹理对象：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0 <span class="token operator">+</span> slot<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>设置纹理统一变量：</p>
<pre class="line-numbers language-unity" data-language="unity"><div class="caption"><span>shader</span></div><code class="language-unity">uniform sampler2D u_Texture;

void main()
{
    vec4 texColor = texture(u_Texture, v_Texcoord);
    color = texColor;
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>实例</strong>：<br>Texture.h:</p>
<pre class="line-numbers language-h" data-language="h"><code class="language-h">#pragma once

#include "Renderer.h"

class Texture
{
private:
    unsigned int m_RendererID;
    std::string m_FilePath;
    unsigned char* m_localBuffer;
    int m_Width, m_Height, m_BPP;

public:
    Texture(const std::string&amp; path);
    ~Texture();

    void Bind(unsigned int slot = 0) const;
    void Unbind() const;

    inline int GetWidth() const { return m_Width; }
    inline int GetHeight() const { return m_Height; }
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Texture.cpp:</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Texture.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STB_IMAGE_IMPLEMENTATION</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"vender\stb_image\stb_image.h"</span></span>

<span class="token class-name">Texture</span><span class="token double-colon punctuation">::</span><span class="token function">Texture</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>path<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">m_RendererID</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_FilePath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_localBuffer</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_Width</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_Height</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_BPP</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Set Image flip flag bits</span>
    <span class="token function">stbi_set_flip_vertically_on_load</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_localBuffer <span class="token operator">=</span> <span class="token function">stbi_load</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_Width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_Height<span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_BPP<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">glGenTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MIN_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_MAG_FILTER<span class="token punctuation">,</span> GL_LINEAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_S<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glTexParameteri</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> GL_TEXTURE_WRAP_T<span class="token punctuation">,</span> GL_CLAMP_TO_EDGE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glTexImage2D</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA8<span class="token punctuation">,</span> m_Width<span class="token punctuation">,</span> m_Height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GL_RGBA<span class="token punctuation">,</span> GL_UNSIGNED_BYTE<span class="token punctuation">,</span> m_localBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_localBuffer<span class="token punctuation">)</span>
        <span class="token function">stbi_image_free</span><span class="token punctuation">(</span>m_localBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Texture</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Texture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">glDeleteTextures</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Texture</span><span class="token double-colon punctuation">::</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> slot<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glActiveTexture</span><span class="token punctuation">(</span>GL_TEXTURE0 <span class="token operator">+</span> slot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> m_RendererID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Texture</span><span class="token double-colon punctuation">::</span><span class="token function">Unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token function">glBindTexture</span><span class="token punctuation">(</span>GL_TEXTURE_2D<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="混合（Blending）"><a href="#混合（Blending）" class="headerlink" title="混合（Blending）"></a>混合（Blending）</h2><p>混合（Blending）是OpenGL中的一种渲染技术，用于将多个片元（像素）的颜色值合成到帧缓冲中。混合通常用于实现半透明、阴影、颜色叠加和其他特效。在混合中，每个片元的颜色和透明度（alpha）与已经存在于帧缓冲中的颜色进行组合，最终呈现在屏幕上。</p>
<p>使用混合的一般步骤：</p>
<ol>
<li><p><strong>启用混合</strong>：在使用混合之前，您需要在OpenGL上下文中启用混合功能。您可以使用 <code>glEnable(GL_BLEND)</code> 来启用混合。通常，这会在初始化OpenGL时进行设置。</p>
</li>
<li><p><strong>设置混合函数</strong>：混合函数（Blend Function）用于定义如何将新像素与背景像素混合。通常，您会使用 <code>glBlendFunc</code> 函数来设置混合函数。例如，<code>glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)</code> 用于标准的alpha混合，其中 <code>GL_SRC_ALPHA</code> 表示新像素的颜色的alpha通道，<code>GL_ONE_MINUS_SRC_ALPHA</code> 表示背景像素的颜色的alpha通道的补数。</p>
</li>
<li><p><strong>启用深度测试（可选）</strong>：如果您同时使用深度测试（Depth Testing），确保深度测试在混合之前执行，以确保像素按正确的顺序渲染。</p>
</li>
<li><p><strong>在片段着色器中处理混合</strong>：在片段着色器中，您可以使用特殊变量 <code>gl_FragColor</code>（或 <code>out</code> 变量）来表示片段的颜色。通过修改这个颜色，您可以实现混合效果。例如，根据透明度，您可以将新像素的颜色与背景像素的颜色混合，以产生透明效果。</p>
</li>
</ol>
<p>示例代码片段：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 启用混合</span>
<span class="token function">glEnable</span><span class="token punctuation">(</span>GL_BLEND<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置混合函数</span>
<span class="token function">glBlendFunc</span><span class="token punctuation">(</span>GL_SRC_ALPHA<span class="token punctuation">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 片段着色器中的混合示例</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 计算混合后的颜色</span>
    vec4 newColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>textureColor<span class="token punctuation">,</span> backgroundColor<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor <span class="token operator">=</span> newColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在上面的示例中，<code>glEnable(GL_BLEND)</code> 启用混合，<code>glBlendFunc</code> 设置混合函数，然后在片段着色器中使用 <code>mix</code> 函数来计算混合后的颜色，并将结果赋给 <code>gl_FragColor</code>。</p>
<p>混合是一个强大的工具，可用于实现各种视觉效果，但也需要小心使用，因为不正确的混合设置可能会导致不期望的结果。根据您的具体需求，您可以尝试不同的混合函数和混合参数来获得所需的效果。</p>
<h2 id="模型视图投影矩阵（Model-View-Projection-Matrix，MVP）"><a href="#模型视图投影矩阵（Model-View-Projection-Matrix，MVP）" class="headerlink" title="模型视图投影矩阵（Model-View-Projection Matrix，MVP）"></a>模型视图投影矩阵（Model-View-Projection Matrix，MVP）</h2><p>在计算机图形学中，模型视图投影矩阵（Model-View-Projection Matrix，通常简写为MVP矩阵）是一种用于将三维物体的坐标变换到二维屏幕坐标的矩阵。MVP矩阵由三个部分组成：模型矩阵（Model Matrix）、视图矩阵（View Matrix）和投影矩阵（Projection Matrix）。这些矩阵协同工作，使您能够将三维物体从它们的本地坐标空间（模型坐标空间）转换到观察者的视图空间，最终将其投影到二维屏幕坐标。</p>
<p>下面是每个部分的简要解释：</p>
<ol>
<li><p><strong>模型矩阵（Model Matrix）</strong>：模型矩阵用于将物体的本地坐标转换为世界坐标。它描述了物体的位置、旋转和缩放。通常，模型矩阵会将物体从其局部坐标系变换到全局坐标系。</p>
</li>
<li><p><strong>视图矩阵（View Matrix）</strong>：视图矩阵定义了观察者的相机位置和方向。它将世界坐标转换为观察者的视图坐标，同时定义了观察方向和相机的位置。视图矩阵使您能够以不同的角度和位置查看场景中的物体。</p>
</li>
<li><p><strong>投影矩阵（Projection Matrix）</strong>：投影矩阵定义了观察体积，即可见场景的空间。它可以是正交投影矩阵（Orthographic Projection）或透视投影矩阵（Perspective Projection）。投影矩阵将视图坐标变换为标准化设备坐标（Normalized Device Coordinates，NDC），以便进行最终的屏幕投影。</p>
</li>
</ol>
<p>MVP矩阵的计算顺序通常如下：</p>
<ol>
<li><p>首先，将模型矩阵应用于物体的本地坐标，将其转换为世界坐标。</p>
</li>
<li><p>然后，将视图矩阵应用于世界坐标，将其变换为观察者的视图坐标。</p>
</li>
<li><p>最后，将投影矩阵应用于视图坐标，将其变换为标准化设备坐标，从而进行屏幕投影。</p>
</li>
</ol>
<p>这个MVP矩阵可以将物体从其本地坐标变换到最终的二维屏幕坐标，以进行渲染。</p>
<pre class="line-numbers language-none"><code class="language-none">uniform mat4 u_MVP;

void main()
{
    gl_Position = u_MVP * positions;
    v_Texcoord = texcoord;
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// 设置物体的本地坐标</span>
<span class="token keyword">float</span> positions<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token number">128.0f</span><span class="token punctuation">,</span> <span class="token number">128.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>   <span class="token comment">// 0</span>
            <span class="token number">256.0f</span><span class="token punctuation">,</span> <span class="token number">128.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span>   <span class="token comment">// 1</span>
            <span class="token number">256.0f</span><span class="token punctuation">,</span>  <span class="token number">256.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span>   <span class="token comment">// 2</span>
            <span class="token number">128.0f</span><span class="token punctuation">,</span>  <span class="token number">256.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span>   <span class="token comment">// 3</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/* Model-View-Projection Matrix */</span>
<span class="token comment">// 将投影矩阵应用于视图坐标，将其变换为标准化设备坐标，从而进行屏幕投影。</span>
glm<span class="token double-colon punctuation">::</span>mat4 proj <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">ortho</span><span class="token punctuation">(</span><span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">640.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">480.0f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             
<span class="token comment">// 将视图矩阵应用于世界坐标，将其变换为观察者的视图坐标。</span>
glm<span class="token double-colon punctuation">::</span>mat4 view <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">translate</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         
<span class="token comment">// 将模型矩阵应用于物体的本地坐标，将其转换为世界坐标。</span>
glm<span class="token double-colon punctuation">::</span>mat4 model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">translate</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      

glm<span class="token double-colon punctuation">::</span>mat4 mvp <span class="token operator">=</span> proj <span class="token operator">*</span> view <span class="token operator">*</span> model<span class="token punctuation">;</span>

shader<span class="token punctuation">.</span><span class="token function">SetUniformMatrix4f</span><span class="token punctuation">(</span><span class="token string">"u_MVP"</span><span class="token punctuation">,</span> mvp<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Sparrow You</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://sparrowyou.github.io/2023/10/15/opengl/">http://sparrowyou.github.io/2023/10/15/opengl/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Sparrow You</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/C/">
                                    <span class="chip bg-color">C++</span>
                                </a>
                            
                                <a href="/tags/OpenGL/">
                                    <span class="chip bg-color">OpenGL</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2023/10/15/cppskills/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="C++小技巧">
                        
                        <span class="card-title">C++小技巧</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-10-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/C/" class="post-category">
                                    C++
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/C/">
                        <span class="chip bg-color">C++</span>
                    </a>
                    
                    <a href="/tags/Tips/">
                        <span class="chip bg-color">Tips</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/09/28/5g/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="5G">
                        
                        <span class="card-title">5G</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-09-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E9%80%9A%E4%BF%A1/" class="post-category">
                                    通信
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E9%80%9A%E4%BF%A1/">
                        <span class="chip bg-color">通信</span>
                    </a>
                    
                    <a href="/tags/5G/">
                        <span class="chip bg-color">5G</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023</span>
            
            <a href="/about" target="_blank">Sparrow You</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2023";
                        var startMonth = "9";
                        var startDate = "28";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-cn';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/sparrowyou" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3259992548@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3259992548" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3259992548" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
